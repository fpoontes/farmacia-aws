<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Farm√°cia Vida+</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;max-width:960px;margin:40px auto;padding:0 16px}
    header{display:flex;align-items:center;justify-content:space-between}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;margin-top:16px}
    .card{border:1px solid #e5e7eb;border-radius:12px;padding:14px}
    .muted{color:#6b7280;font-size:14px}
    button{cursor:pointer;border:none;border-radius:10px;padding:8px 12px}
    button.buy{background:#16a34a;color:white}
    footer{margin-top:32px;color:#6b7280;font-size:12px}
    .api{margin:8px 0 0 0}
    input{padding:8px;border:1px solid #e5e7eb;border-radius:8px;width:360px}
  </style>
</head>
<body>
  <header>
    <h1>ü©∫ Farm√°cia Vida+</h1>
    <div>
      <label class="muted" for="api">API base URL:</label>
      <input id="api" value="" placeholder="cole aqui a URL de sa√≠da do Terraform"/>
    </div>
  </header>

  <p class="muted">Cat√°logo simples consumindo API Gateway + Lambda + DynamoDB.</p>

  <div class="grid" id="grid"></div>

  <footer>Projeto educacional ‚Äî DIO Bootcamp ‚Ä¢ AWS Serverless</footer>

  <script>
    const grid = document.getElementById('grid');
    const apiInput = document.getElementById('api');

    function apiBase() {
      return apiInput.value.replace(/\/$/, '');
    }

    async function load() {
      grid.innerHTML = '<p class="muted">Carregando‚Ä¶</p>';
      try {
        const res = await fetch(apiBase() + '/products');
        const data = await res.json();
        grid.innerHTML = data.map(p => `
          <div class="card">
            <h3>${p.name}</h3>
            <p class="muted">R$ ${p.price.toFixed(2)} ‚Ä¢ estoque: ${p.stock}</p>
            <button class="buy" onclick="buy('${p.id}')">Comprar</button>
          </div>
        `).join('');
      } catch (e) {
        grid.innerHTML = '<p class="muted">Erro ao carregar. Confira a API base URL e CORS.</p>';
      }
    }

    async function buy(id) {
      try {
        const res = await fetch(apiBase() + '/orders', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ productId: id, qty: 1, customer: 'felipe@exemplo.com' })
        });
        const out = await res.json();
        alert(res.status === 201 ? 'Pedido criado: ' + out.id : 'Falha: ' + (out.message || 'erro'));
        load();
      } catch(e) {
        alert('Erro de rede');
      }
    }

    apiInput.addEventListener('change', load);
  </script>
</body>
</html>
